<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="jszip.min.js"></script>
     <script src="https://code.jquery.com/ui/1.14.1/jquery-ui.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://code.jquery.com/ui/1.14.1/themes/base/jquery-ui.css">
<script src="https://cdn.jsdelivr.net/gh/rainabba/jquery-table2excel@1.1.0/dist/jquery.table2excel.min.js"></script>
</head>
<body>
    <div class="container mt-5">
        <form id="amortizationForm" class="mb-4">
            <div class="form-group">
                <label for="principal">Monto del Préstamo:</label>
                <input type="number" id="principal" class="form-control" placeholder="Ingrese el monto del préstamo" value="100000" required>
            </div>
           
            <div class="form-group">
                <label for="months">Número de Meses:</label>
                <input type="number" id="months" class="form-control" placeholder="Ingrese el número de meses" value="24" required>
            </div>
            <div class="form-group">
                <label for="months">Edad:</label>
                <input type="number" id="edad" class="form-control" placeholder="Ingrese su edad" value="18" required>
            </div>
            <div class="form-group ui-widget">
                <label for="months">País de nacimiento:</label>
                <input type="text" id="nacionalidad" class="form-control" placeholder="Nacionalidad" value="México" required>
               
            </div>

            <div class="form-group">
                <label for="months">Buro de credito (bueno, regular,malo):</label>
                <input type="text" id="buro" value="bueno" class="form-control" placeholder="bueno, regular,malo" required>
            </div>
             <div class="form-group">
                <label for="annualInterestRate">Tasa de Interés Anual (%):</label>
                <input type="number" value="10"  id="annualInterestRate" class="form-control" placeholder="Ingrese la tasa de interés anual" step="0.01" required>
            </div>
            <button type="submit" class="btn btn-primary mt-3">Actualizar Tabla</button>
        </form>

    
         <table  class="table table-bordered table-striped mt-4">
            <thead class="thead-dark">
                <tr>
                    <tr>
                        <th colspan="5" style="text-align: center; font-size: large;">Tabla Amortización  </th>
                    </tr>
                    <tr>
                        <th colspan="4" style="text-align: right;">Monto: </th>
                        <th  id="montotabla">100000  </th>
                    </tr>
                    <tr>
                        <th colspan="4" style="text-align: right;">Tasa: </th>
                        <th   id="tasatabla">10</th>
                    </tr>
                    <tr>
                        <th colspan="4" style="text-align: right;">Meses: </th>
                        <th   id="mesestabla">24</th>
                    </tr>
                    <th>Mes</th>
                    <th>Pago Mensual</th>
                    <th>Interés</th>
                    <th>Amortización</th>
                    <th>Saldo</th>
                </tr>
               
            </thead>
            <tbody id="amortizationTable" class="table"></tbody>
                <!-- Rows will be dynamically generated -->
            </tbody>
        </table>
        
        <button type="button" onclick="Exportar('tblamortiza');;"  class="btn btn-link">Exportar datos a Excel</button>
       
         <table id="tblamortiza" style="visibility: hidden;" class="table table-bordered table-striped mt-4">
            <thead class="thead-dark">
                <tr>
                    <tr>
                        <th colspan="5" style="text-align: center; font-size: large;">Tabla Amortización  </th>
                    </tr>
                    <tr>
                        <th colspan="4" style="text-align: right;">Monto: </th>
                        <th  id="montotabla2">=moneda(100000 ) </th>
                    </tr>
                    <tr>
                        <th colspan="4" style="text-align: right;">Tasa: </th>
                        <th   id="tasatabla2">10</th>
                    </tr>
                    <tr>
                        <th colspan="4" style="text-align: right;">Meses: </th>
                        <th   id="mesestabla2">24</th>
                    </tr>
                    <th style="width: 30px;">Mes</th>
                    <th style="width: 150px;">Pago Mensual</th>
                    <th style="width: 150px;">Interés</th>
                    <th style="width: 150px;">Amortización</th>
                    <th style="width: 150px;">Saldo</th>
                </tr>
               
            </thead>
            <tbody id="amortizationOculta"  class="table"></tbody>
                <!-- Rows will be dynamically generated -->
            </tbody>
        </table>
      
    </div> 
    
    <script>
            $("#amortizationForm").on("submit", function (e) {
                e.preventDefault();

                const principal = parseFloat($("#principal").val());
                const annualInterestRate = parseFloat($("#annualInterestRate").val()) / 100;
                const months = parseInt($("#months").val());
                const monthlyInterestRate = annualInterestRate / 12;
                const monthlyPayment = (principal * monthlyInterestRate) / (1 - Math.pow(1 + monthlyInterestRate, -months));
                let balance = principal;
$("#montotabla").text(principal.toFixed(2));
$("#tasatabla").text(annualInterestRate.toFixed(2));
$("#mesestabla").text(months);
$("#montotabla2").text("=moneda("+principal.toFixed(2)+")");
$("#tasatabla2").text(annualInterestRate.toFixed(2) );
$("#mesestabla2").text(months);   
                $("#amortizationTable").empty();
                $("#amortizationOculta").empty();

                $("#amortizationTable").append(`
                        <tr>
                            <td>0</td>
                            <td>-</td>
                            <td>-</td>
                            <td>-</td>
                            <td>${balance.toFixed(2)}</td>
                        </tr>
                    `);
                    $("#amortizationOculta").append(`
                        <tr>
                            <td>0</td>
                            <td>-</td>
                            <td>-</td>
                            <td>-</td>
                            <td>=moneda(${balance.toFixed(2)})</td>
                        </tr>
                    `);
                for (let i = 1; i <= months; i++) {
                    const interest = balance * monthlyInterestRate;
                    const amortization = monthlyPayment - interest;
                    balance -= amortization;

                    $("#amortizationTable").append(`
                        <tr>
                            <td>${i}</td>
                            <td>${monthlyPayment.toFixed(2)}</td>
                            <td>${interest.toFixed(2)}</td>
                            <td>${amortization.toFixed(2)}</td>
                            <td>${balance.toFixed(2)}</td>
                        </tr>
                    `); 
                    $("#amortizationOculta").append(`
                        <tr>
                            <td>=a${i+6}+1</td>
                            <td>=moneda((E$3*(E$4*100/12))/(1-POTENCIA(1+(E$4*100/12),-E$5)))</td>
                            <td>=moneda(E${i+6}*(E$4*100/12))</td>
                            <td>=moneda(B${i+7}-C${i+7})</td>
                            <td>=moneda(e${i+6}-b${i+7}+c${i+7})</td>
                        </tr>
                    `); 
                }
            });
        </script> 
     <script>
        $(document).ready(function () {
            const nacionalidades = [
                "Afganistán", "Albania", "Alemania", "Andorra", "Angola", "Antigua y Barbuda", "Arabia Saudita", 
                "Argelia", "Argentina", "Armenia", "Australia", "Austria", "Azerbaiyán", "Bahamas", "Bangladés", 
                "Barbados", "Baréin", "Bélgica", "Belice", "Benín", "Bielorrusia", "Birmania", "Bolivia", 
                "Bosnia y Herzegovina", "Botsuana", "Brasil", "Brunéi", "Bulgaria", "Burkina Faso", "Burundi", 
                "Bután", "Cabo Verde", "Camboya", "Camerún", "Canadá", "Catar", "Chad", "Chile", "China", 
                "Chipre", "Colombia", "Comoras", "Corea del Norte", "Corea del Sur", "Costa de Marfil", 
                "Costa Rica", "Croacia", "Cuba", "Dinamarca", "Dominica", "Ecuador", "Egipto", "El Salvador", 
                "Emiratos Árabes Unidos", "Eritrea", "Eslovaquia", "Eslovenia", "España", "Estados Unidos", 
                "Estonia", "Etiopía", "Filipinas", "Finlandia", "Fiyi", "Francia", "Gabón", "Gambia", "Georgia", 
                "Ghana", "Granada", "Grecia", "Guatemala", "Guinea", "Guinea-Bisáu", "Guinea Ecuatorial", 
                "Guyana", "Haití", "Honduras", "Hungría", "India", "Indonesia", "Irak", "Irán", "Irlanda", 
                "Islandia", "Islas Marshall", "Islas Salomón", "Israel", "Italia", "Jamaica", "Japón", 
                "Jordania", "Kazajistán", "Kenia", "Kirguistán", "Kiribati", "Kuwait", "Laos", "Lesoto", 
                "Letonia", "Líbano", "Liberia", "Libia", "Liechtenstein", "Lituania", "Luxemburgo", "Macedonia", 
                "Madagascar", "Malasia", "Malaui", "Maldivas", "Malí", "Malta", "Marruecos", "Mauricio", 
                "Mauritania", "México", "Micronesia", "Moldavia", "Mónaco", "Mongolia", "Montenegro", 
                "Mozambique", "Namibia", "Nauru", "Nepal", "Nicaragua", "Níger", "Nigeria", "Noruega", 
                "Nueva Zelanda", "Omán", "Países Bajos", "Pakistán", "Palaos", "Panamá", "Papúa Nueva Guinea", 
                "Paraguay", "Perú", "Polonia", "Portugal", "Reino Unido", "República Centroafricana", 
                "República Checa", "República del Congo", "República Democrática del Congo", "República Dominicana", 
                "Ruanda", "Rumanía", "Rusia", "Samoa", "San Cristóbal y Nieves", "San Marino", "San Vicente y las Granadinas", 
                "Santa Lucía", "Santo Tomé y Príncipe", "Senegal", "Serbia", "Seychelles", "Sierra Leona", 
                "Singapur", "Siria", "Somalia", "Sri Lanka", "Suazilandia", "Sudáfrica", "Sudán", "Sudán del Sur", 
                "Suecia", "Suiza", "Surinam", "Tailandia", "Tanzania", "Tayikistán", "Timor Oriental", "Togo", 
                "Tonga", "Trinidad y Tobago", "Túnez", "Turkmenistán", "Turquía", "Tuvalu", "Ucrania", "Uganda", 
                "Uruguay", "Uzbekistán", "Vanuatu", "Vaticano", "Venezuela", "Vietnam", "Yemen", "Yibuti", 
                "Zambia", "Zimbabue"
            ];
            const estadosBuro = [
                "bueno", "malo", "regular"
            ];
            $("#nacionalidad").autocomplete({
                source: function (request, response) {
                    const term = request.term.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
                    const filtered = nacionalidades.filter(nacionalidad => 
                        nacionalidad.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").includes(term)
                    );
                    response(filtered);
                }
            });
            $("#buro").autocomplete({
                source: estadosBuro
            });
        });
    </script>
    <script>
      function Exportar(varnombretabla){
    var uri = 'data:application/vnd.ms-excel;base64,'
    , template = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><meta http-equiv="content-type" content="application/vnd.ms-excel; charset=UTF-8"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>'
    , base64 = function (s) { return window.btoa(unescape(encodeURIComponent(s))) }
    , format = function (s, c) { return s.replace(/{(\w+)}/g, function (m, p) { return c[p]; }) }

    var table = varnombretabla;
    var name = 'nombre_hoja_calculo';

    if (!table.nodeType) table = document.getElementById(table)
     var ctx = { worksheet: name || 'Worksheet', table: table.innerHTML }
     window.location.href = uri + base64(format(template, ctx))
}
   </script>
 
</body> 
</html>
